from telnetlib import Telnet
import os

RHOST = "127.0.0.1"
RPORT = 1001

def crack_seed(target_num):
    # Make sure to complile the seed_cracker.c to crack the seed
    return os.popen("./cracker {num}".format(num=target_num)).read().split("\n")[:-1]

def main():

    with Telnet(RHOST, RPORT) as r_conn:
        r_conn.read_until("I am thinking of a random integer, which number do you think it is?\n".encode())

        # Hope that you guess incorrectly to get the first random number from the seed that is set
        r_conn.write("-1\n".encode())
        # Skip the first newline char that is sent after guessing a number
        r_conn.read_until("\n".encode())
        failed_str = r_conn.read_until("\n".encode()).decode()
        # Grab the target num to use to crack the seed used
        target_num = failed_str.split(' ')[-1][:-2]

        next_nums = crack_seed(target_num)

        for num in next_nums:
            payload = num + "\n"
            r_conn.write(payload.encode())

        print(r_conn.read_all().decode())


if __name__ == "__main__":
    main()
